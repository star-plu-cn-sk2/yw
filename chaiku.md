# 为何要拆库
## 问题

- 当前业务数据库是一个大而全数据库，所有业务数据都存放在同一个数据库中。随着各业务的不断发展，大而全数据库的一些问题逐渐暴露出来。主要有以下问题：

 - 风险捆绑。各业务公用一个数据库，相互之间存在影响。假设，业务A因程序bug或者人为操作失误导致数据库出现故障或者资源紧张，此时业务B也会受到影响。
 - 单库体量大，维护成本高。例如，数据库备份时间长达9个钟、日常维护需要考虑所有业务时间
 - 开发成本高，容易混淆误解。

## 好处

 - 风险分摊。拆库后业务数据库各自独立，相互之间各不干扰。业务A数据库出现故障，不会影响到业务B。
 - 降低单库体量，降低维护成本。DBA可根据不同业务的情况，调整时间。设备升级互不影响

## 如何拆库

 - 利用现有数据库主从同步机制，新增一台从库服务器。
 - 当新的从库数据同步追赶上（延迟在很短时间内）主库后，停止业务应用。
 - 等待新的从库追上应用停机时候的binlog位置，然后将新的从库调整为独立的主库。
 - 业务应用切换数据库连接到新的主库
 - 完成上述步骤，再观察一周后。各业务根据情况清理数据库不相关的业务表

##　风险注意点

－　风险评估：低。因为本次拆库本质上是对部分业务做一次主从数据库的切换。

注意事项：

 - 检查新增数据库，服务器网络配置（白名单等）。
 - 检查新增数据库与原有数据库基础配置是否一致
 - 数据库账号、密码、用户权限、存储过程、函数是否一致
 - 检查各应用数据库连接是否正确
 - 服务器网络访问限制，每个业务只能访问自己对应的数据库
 - 提前通知相关部门，拆库事宜
